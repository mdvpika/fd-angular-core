{"version":3,"sources":["../src/State.js"],"names":[],"mappings":"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","file":"State.js","sourcesContent":["import {funcMeta} from \"./utils\";\nimport {Controller} from \"./Controller\";\n\nconst DEFAULT_SUFFIX = \"Controller\";\n\n/**\n@function State\n@param {Object}  opts - The options\n@param {string}  [opts.name] - The name of the state.\n@param {string}  [opts.hidden] - Hide this state from the state path.\n@param {string}  [opts.bindTo] - Bind the controller to the provided name.\n@param {string}  [opts.url] - The url of the state.\n@param {Boolean} [opts.abstract] - True for abstract states.\n@param {string}  [opts.template] - An angular template.\n@param {string}  [opts.templateUrl] - A URL to an angular template.\n@param {State[]} [opts.children] - List of child states.\n@param {string}  [opts.controllerName] - The name of the controller as seen by angular.\n@param {Object}  [opts.resolve] - Any required resolved.\n@param {Object}  [opts.views] - State views\n\n@example\n[@]State({\n\turl: \"/\",\n\ttemplate: `<h1>Hello World</h1>`,\n})\nclass HelloWorld {\n}\n*/\nexport function State(opts) {\n\tif (typeof opts === \"function\") {\n\t\tlet constructor = opts; opts = null;\n\t\treturn register(constructor);\n\t}\n\n\topts = (opts || {});\n\n\treturn register;\n\n\tfunction register(constructor) {\n\t\tregisterLock(constructor);\n\t\tController(constructor, { name: opts.controllerName });\n\n\t\tlet meta = stateMeta(constructor);\n\t\tlet superMeta = stateMeta(meta.superClass) || { state: {} };\n\n\t\tlet prototype = constructor.prototype;\n\t\tif (prototype.activate) {\n\t\t\tmeta.state.callbacks.onActivate.push(prototype.activate);\n\t\t}\n\t\tif (prototype.attach) {\n\t\t\tmeta.state.callbacks.onAttach.push(prototype.attach);\n\t\t}\n\t\tif (prototype.detach) {\n\t\t\tmeta.state.callbacks.onDetach.push(prototype.detach);\n\t\t}\n\n\t\tif (superMeta.state.callbacks) {\n\t\t\tmeta.state.callbacks.onActivate = superMeta.state.callbacks.onActivate\n\t\t\t\t.concat(meta.state.callbacks.onActivate);\n\t\t\tmeta.state.callbacks.onAttach = superMeta.state.callbacks.onAttach\n\t\t\t\t.concat(meta.state.callbacks.onAttach);\n\t\t\tmeta.state.callbacks.onDetach = superMeta.state.callbacks.onDetach\n\t\t\t\t.concat(meta.state.callbacks.onDetach);\n\t\t}\n\n\t\tif (opts.children === false) {\n\t\t\tmeta.state.children = null;\n\t\t} else if (opts.children) {\n\t\t\tmeta.state.children = opts.children;\n\t\t} else if (superMeta.state.children) {\n\t\t\tmeta.state.children = superMeta.state.children;\n\t\t}\n\t\tif (!meta.state.children) {\n\t\t\tmeta.state.children = [];\n\t\t}\n\n\t\tif (opts.name) {\n\t\t\tmeta.state.name = opts.name;\n\t\t} else {\n\t\t\tlet name = meta.name;\n\t\t\tname = name[0].toLowerCase() + name.substr(1, name.length - DEFAULT_SUFFIX.length - 1);\n\t\t\tmeta.state.name = name;\n\t\t}\n\n\t\tlet views = {};\n\t\tif (superMeta.state.views) {\n\t\t\tObject.assign(views, superMeta.state.views);\n\t\t}\n\t\tif (opts.views) {\n\t\t\tObject.assign(views, opts.views);\n\t\t}\n\t\tif (opts.template === false) {\n\t\t\tviews[''] = undefined;\n\t\t} else if (opts.template !== undefined) {\n\t\t\tviews[''] = { template: opts.template, bindTo: (opts.bindTo || meta.state.name) };\n\t\t} else if (opts.templateUrl) {\n\t\t\tviews[''] = { templateUrl: opts.templateUrl, bindTo: (opts.bindTo || meta.state.name) };\n\t\t}\n\t\tmeta.state.views = views;\n\n\t\tif (opts.url !== false) {\n\t\t\tif (opts.url !== undefined) {\n\t\t\t\tmeta.state.url = opts.url;\n\t\t\t} else if (superMeta.state.url !== undefined) {\n\t\t\t\tmeta.state.url = superMeta.state.url;\n\t\t\t}\n\t\t}\n\n\t\tif (opts.abstract === undefined) {\n\t\t\tmeta.state.abstract = superMeta.state.abstract;\n\t\t} else if (opts.abstract === true) {\n\t\t\tmeta.state.abstract = true;\n\t\t} else if (opts.abstract === false) {\n\t\t\tmeta.state.abstract = false;\n\t\t}\n\n\t\tif (opts.hidden === undefined) {\n\t\t\tmeta.state.hidden = superMeta.state.hidden;\n\t\t} else if (opts.hidden === true) {\n\t\t\tmeta.state.hidden = true;\n\t\t} else if (opts.hidden === false) {\n\t\t\tmeta.state.hidden = false;\n\t\t}\n\n\t\tmeta.state.resolve = {};\n\t\tif (opts.resolve !== false) {\n\t\t\tObject.assign(meta.state.resolve, superMeta.state.resolve);\n\t\t\tif (opts.resolve) {\n\t\t\t\tObject.assign(meta.state.resolve, opts.resolve);\n\t\t\t}\n\t\t}\n\n\t}\n}\n\nfunction stateMeta(constructor) {\n\tif (!constructor) {\n\t\treturn null;\n\t}\n\n\tlet meta = funcMeta(constructor);\n\n\tif (meta.state) {\n\t\treturn meta;\n\t}\n\n\tmeta.state = {\n\t\tcallbacks: {\n\t\t\tonActivate: [],\n\t\t\tonAttach:   [],\n\t\t\tonDetach:   [],\n\t\t},\n\t};\n\n\treturn meta;\n}\n\nfunction registerLock(constructor) {\n\tlet meta = stateMeta(constructor);\n\n\tif (meta.state.registered) {\n\t\tthrow \"@State() can only be used once!\";\n\t}\n\n\tmeta.state.registered = true;\n}\n\nState.onActivate = function onActivate(target, name, desc) {\n\tif (typeof desc.value !== \"function\") {\n\t\tthrow \"@State.onActivate expects a function target\";\n\t}\n\n\tlet meta = stateMeta(target.constructor);\n\tmeta.state.callbacks.onActivate.push(desc.value);\n};\n\nState.onAttach = function onAttach(target, name, desc) {\n\tif (typeof desc.value !== \"function\") {\n\t\tthrow \"@State.onAttach expects a function target\";\n\t}\n\n\tlet meta = stateMeta(target.constructor);\n\tmeta.state.callbacks.onAttach.push(desc.value);\n};\n\nState.onDetach = function onDetach(target, name, desc) {\n\tif (typeof desc.value !== \"function\") {\n\t\tthrow \"@State.onDetach expects a function target\";\n\t}\n\n\tlet meta = stateMeta(target.constructor);\n\tmeta.state.callbacks.onDetach.push(desc.value);\n};\n\n/**\n@function mountAt\n@param {String} url\n@param {Object} [opts]\n@param {String} [opts.name]\n\n@example\nSomeState::mountAt(\"/some/url\")\n*/\nexport function mountAt(url, opts={}) {\n\tlet {name} = opts;\n\n\treturn {\n\t\tstate:              this,\n\t\turl:                url,\n\t\tname:               name,\n\t\tbuildUiRouterState: builder,\n\t};\n\n\tfunction builder() {\n\t\tlet state = buildUiRouterState(this.state);\n\n\t\tif (this.url) {\n\t\t\tstate.url = url;\n\t\t}\n\n\t\tif (this.name) {\n\t\t\tstate.name = name;\n\t\t}\n\n\t\treturn state;\n\t}\n}\n\nexport function buildUiRouterState(obj) {\n\tif (!obj) {\n\t\treturn null;\n\t}\n\n\tif (obj.buildUiRouterState) {\n\t\tlet state = obj.buildUiRouterState();\n\t\treturn state;\n\t}\n\n\tlet meta = funcMeta(obj);\n\tif (!meta.state) {\n\t\tthrow Error(\"provided object is not a state\");\n\t}\n\n\tlet children = [];\n\tfor (let child of meta.state.children) {\n\t\tchildren.push(buildUiRouterState(child));\n\t}\n\n\tlet views = {};\n\tfor (let key of Object.keys(meta.state.views)) {\n\t\tlet view = meta.state.views[key];\n\t\tif (!view) { continue; }\n\n\t\tviews[key] = {\n\t\t\ttemplate:     view.template,\n\t\t\ttemplateUrl:  view.templateUrl,\n\t\t\tcontrollerAs: (view.bindTo || meta.state.bindTo || meta.state.name),\n\t\t\tcontroller:   controllerAttacher,\n\t\t};\n\t}\n\tif (meta.state.views[''] === undefined) {\n\t\tif (children.length > 0) {\n\t\t\tviews[''] = {\n\t\t\t\ttemplate:     '<ui-view></ui-view>',\n\t\t\t\tcontrollerAs: (meta.state.bindTo || meta.state.name),\n\t\t\t\tcontroller:   controllerAttacher,\n\t\t\t};\n\t\t} else {\n\t\t\tviews[''] = {\n\t\t\t\ttemplate:     '',\n\t\t\t\tcontrollerAs: (meta.state.bindTo || meta.state.name),\n\t\t\t\tcontroller:   controllerAttacher,\n\t\t\t};\n\t\t}\n\t}\n\n\tlet resolve = {};\n\tObject.assign(resolve, meta.state.resolve);\n\tcontrollerProvider.$inject = ['$q', '$controller', '$locals', '$injector'].concat(Object.keys(resolve));\n\tcontrollerAttacher.$inject = [meta.state.name, '$locals', '$injector', '$scope'].concat(Object.keys(resolve));\n\tresolve[meta.state.name] = controllerProvider;\n\tresolve.$viewCounter = () => ({ attached: 0, count: Object.keys(views).length });\n\n\tcontrollerProvider.$inject = controllerProvider.$inject.concat(meta.top.$inject || []);\n\tfor (let clb of meta.state.callbacks.onActivate) {\n\t\tcontrollerProvider.$inject = controllerProvider.$inject.concat(clb.$inject || []);\n\t}\n\n\tlet state = {\n\t\tname:        meta.state.name,\n\t\turl:         meta.state.url,\n\t\thiddenState: meta.state.hidden,\n\t\tabstract:    meta.state.abstract,\n\t\tchildren:    children,\n\t\tresolve:     resolve,\n\t\tviews:       views,\n\t};\n\n\treturn state;\n\n\tfunction controllerProvider($q, $controller, $locals, $injector) {\n\t\treturn $q(function(ok, err) {\n\t\t\ttry {\n\t\t\t\tlet ctrl = $controller(meta.controller.name, $locals);\n\t\t\t\tlet p = $q.when(ctrl);\n\n\t\t\t\tfor (let clb of meta.state.callbacks.onActivate) {\n\t\t\t\t\tp = p.then(() => $injector.invoke(clb, ctrl, $locals));\n\t\t\t\t}\n\n\t\t\t\tp = p.then(() => ctrl);\n\t\t\t\tok(p);\n\t\t\t} catch (e) {\n\t\t\t\terr(e);\n\t\t\t}\n\t\t})\n\t\t.catch(err => {\n\t\t\tconsole.error(\"Error:\", err);\n\t\t\treturn $q.reject(err);\n\t\t});\n\t}\n\n\tfunction controllerAttacher(ctrl, $locals, $injector, $scope) {\n\t\tfor (let clb of meta.state.callbacks.onAttach) {\n\t\t\t$injector.invoke(clb, ctrl, $locals);\n\t\t}\n\n\t\t$scope.$on(\"$destroy\", function() {\n\t\t\tfor (let clb of meta.state.callbacks.onDetach) {\n\t\t\t\t$injector.invoke(clb, ctrl, $locals);\n\t\t\t}\n\t\t});\n\n\t\treturn ctrl;\n\t}\n}\n\nexport function flattenUiRouterStates(state, acc=[]) {\n\tacc.push(state);\n\n\tif (state.children) {\n\t\tlet prefix = state.name;\n\t\tif (state.hiddenState) {\n\t\t\tif (state.parent) {\n\t\t\t\tprefix = state.parent.name;\n\t\t\t} else {\n\t\t\t\tprefix = null;\n\t\t\t}\n\t\t}\n\n\t\tfor (let child of state.children) {\n\t\t\tchild.parent = state;\n\n\t\t\tif (prefix && !child.absoluteName) {\n\t\t\t\tchild.name = `${prefix}.${child.name}`;\n\t\t\t}\n\n\t\t\tflattenUiRouterStates(child, acc);\n\t\t}\n\t}\n\n\treturn acc;\n}\n"]}