{"version":3,"sources":["../src/State.js"],"names":[],"mappings":"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","file":"State.js","sourcesContent":["import {funcName, dashCase, superClass} from './utils';\nimport {app} from './app';\nimport {Controller} from './Controller';\n\nconst DEFAULT_SUFFIX = 'Controller';\n\nexport function State(opts) {\n  if (typeof opts === 'function') {\n    var constructor = opts; opts = null;\n    return register(constructor);\n  }\n\n  opts = (opts || {});\n\n  return register;\n\n  function register(constructor) {\n    Controller(constructor, { name: opts.controllerName });\n\n    let prototype = constructor.prototype;\n\n    if (prototype.activate) {\n      State.onActivate(\n        prototype,\n        \"activate\",\n        { value: prototype.activate });\n    }\n\n    if (prototype.attach) {\n      State.onAttach(\n        prototype,\n        \"attach\",\n        { value: prototype.attach });\n    }\n\n    if (prototype.detach) {\n      State.onDetach(\n        prototype,\n        \"detach\",\n        { value: prototype.detach });\n    }\n\n    let callbacks = (prototype.$$stateCallbacks || {});\n    delete prototype['$$stateCallbacks'];\n\n    let meta = registerLock(constructor);\n    let superMeta = superClass(constructor).$$state;\n    superMeta = (superMeta || {});\n\n    {\n      let _opts = Object.create(superMeta.opts || {}, {});\n\n      let keys = Object.keys(opts);\n      for (let idx in keys) {\n        let key = keys[idx];\n        let val = opts[key];\n\n        // Ignored keys\n        if (key === 'name') continue;\n        if (key === 'controllerName') continue;\n        if (key === 'resolve') continue;\n        // if (key === '$onEnter') continue;\n        // if (key === '$onExit') continue;\n\n        _opts[key] = val;\n      }\n\n      { // Inherit resolve\n        let _resolve = Object.create((_opts.resolve || {}), {});\n        let keys = Object.keys(opts.resolve || {});\n        for (let idx in keys) {\n          let key = keys[idx];\n          _resolve[key] = opts.resolve[key];\n        }\n        _opts.resolve = _resolve;\n      }\n\n      { // Inherit children\n        _opts.children = (opts.children || _opts.children || []).concat([]);\n      }\n\n      opts = _opts;\n    }\n\n    applyDefaultName(opts, constructor);\n    applyDefaultTemplate(opts);\n\n    meta.opts = opts;\n    meta.name = opts.name;\n\n    let state = meta.state = {\n      name:          opts.name,\n      template:      opts.template,\n      templateUrl:   opts.templateUrl,\n      controllerAs:  (opts.bindTo || opts.name),\n      url:           opts.url,\n      abstract:      opts.abstract,\n      children:      opts.children.map(x => x.$$state.state),\n      resolve:       Object.create(opts.resolve, {})\n    };\n\n    let controllerProvider = function controllerProvider(ctrl, $hooks, $scope) {\n      try {\n        if ($hooks.attach) {\n          for (let hook of $hooks.attach) { hook.call(ctrl); }\n        }\n\n        $scope.$on('$destroy', function() {\n          if ($hooks.detach) {\n            for (let hook of $hooks.detach) { hook.call(ctrl); }\n          }\n        });\n      } catch(e) {\n        console.error(e);\n        throw e;\n      }\n\n      return ctrl;\n    };\n\n    controllerProvider = controllerProvider\n      ::inject(opts.name, '$hooks', '$scope');\n\n    if (callbacks.onAttach) {\n      for (let hook of callbacks.onAttach) {\n        controllerProvider = controllerProvider::pushHook('attach', hook);\n      }\n    }\n    if (callbacks.onDetach) {\n      for (let hook of callbacks.onDetach) {\n        controllerProvider = controllerProvider::pushHook('detach', hook);\n      }\n    }\n\n    state.controller = controllerProvider;\n\n    let ctrlR = function($q, $controller, $constructorInject, $hooks) {\n      let ctrl;\n      let p;\n\n      try {\n        ctrl = $controller(constructor.$$controller.name, $constructorInject);\n        p = $q.when(ctrl);\n      } catch(e) {\n        console.error(e);\n        return $q.reject(e);\n      }\n\n      if ($hooks.activate) {\n        for (let hook of $hooks.activate) {\n          p = p.then(x => hook.call(ctrl));\n        }\n        p = p.then(x => ctrl);\n      }\n\n      return p;\n    };\n\n    ctrlR = ctrlR\n      ::inject('$q', '$controller', '$constructorInject', '$hooks')\n      ::namedInjectionCollector('$constructorInject', constructor.$inject);\n\n    if (callbacks.onActivate) {\n      for (let hook of callbacks.onActivate) {\n        ctrlR = ctrlR::pushHook('activate', hook);\n      }\n    }\n\n    state.resolve[opts.name] = ctrlR;\n  }\n}\n\nState.onActivate = function onActivate(target, name, desc) {\n  if (typeof desc.value !== 'function') {\n    throw \"@State.onActivate expects a function target\";\n  }\n\n  if (!target.$$stateCallbacks) {\n    target.$$stateCallbacks = {};\n  }\n  if (!target.$$stateCallbacks.onActivate) {\n    target.$$stateCallbacks.onActivate = [];\n  }\n\n  target.$$stateCallbacks.onActivate.push(desc.value);\n};\n\nState.onAttach = function onAttach(target, name, desc) {\n  if (typeof desc.value !== 'function') {\n    throw \"@State.onAttach expects a function target\";\n  }\n\n  if (!target.$$stateCallbacks) {\n    target.$$stateCallbacks = {};\n  }\n  if (!target.$$stateCallbacks.onAttach) {\n    target.$$stateCallbacks.onAttach = [];\n  }\n\n  target.$$stateCallbacks.onAttach.push(desc.value);\n};\n\nState.onDetach = function onDetach(target, name, desc) {\n  if (typeof desc.value !== 'function') {\n    throw \"@State.onDetach expects a function target\";\n  }\n\n  if (!target.$$stateCallbacks) {\n    target.$$stateCallbacks = {};\n  }\n  if (!target.$$stateCallbacks.onDetach) {\n    target.$$stateCallbacks.onDetach = [];\n  }\n\n  target.$$stateCallbacks.onDetach.push(desc.value);\n};\n\nexport function mountAt(url) {\n  let state = Object.create(this.$$state.state, {});\n  state.url = url;\n\n  let $$state = Object.create(this.$$state, {});\n  $$state.state = state;\n\n  let _this = Object.create(this, {});\n  _this.$$state = $$state;\n\n  return _this;\n}\n\nfunction registerLock(constructor) {\n  var lock = constructor.$$state;\n\n  if (lock && (lock.constructor === constructor)) {\n    throw \"@State() can only be used once!\";\n  }\n\n  constructor.$$state = { constructor };\n  return constructor.$$state;\n}\n\nfunction applyDefaultName(opts, constructor) {\n  if (opts.name) return;\n\n  let name = opts.name;\n  name = funcName(constructor);\n  name = name[0].toLowerCase() + name.substr(1, name.length - DEFAULT_SUFFIX.length - 1);\n  opts.name = name;\n}\n\nfunction applyDefaultTemplate(opts) {\n  let {template, templateUrl, children} = opts;\n\n  if (template !== undefined || templateUrl !== undefined) {\n    return;\n  }\n\n  if (children && children.length > 0) {\n    opts.template = `<ui-view></ui-view>`;\n  }\n}\n\nfunction inject(...splat) {\n  if (splat.length === 1 && !splat[0]) {\n    splat = [];\n  }\n  if (splat.length === 1 && splat[0].length > 0) {\n    splat = splat[0];\n  }\n\n  this.$inject = splat;\n  return this;\n}\n\nfunction injectionCollector(as, ...splat) {\n  if (splat.length === 1 && !splat[0]) {\n    splat = [];\n  }\n  if (splat.length === 1 && splat[0].length > 0) {\n    splat = splat[0];\n  }\n\n  let base      = this;\n  let inject    = (base.$inject || []).concat([]);\n  let injectLen = base.$inject.length;\n  let splatIdxs = []\n\n  let idx = inject.indexOf(as);\n  if (idx < 0) { return base; }\n\n  while (idx >= 0) {\n    splatIdxs.unshift(idx);\n    inject.splice(idx, 1);\n    injectLen--;\n    idx = inject.indexOf(as);\n  }\n\n  inject = inject.concat(splat);\n  collectInjections.$inject = inject;\n  return collectInjections;\n\n  function collectInjections() {\n    let inject = Array.prototype.slice.call(arguments, 0, injectLen);\n    let splat  = Array.prototype.slice.call(arguments, injectLen);\n\n    for (let idx in splatIdxs) {\n      inject.splice(splatIdxs[idx], 0, splat);\n    }\n\n    return base.apply(this, inject);\n  }\n}\n\nfunction namedInjectionCollector(as, ...splat) {\n  if (splat.length === 1 && !splat[0]) {\n    splat = [];\n  }\n  if (splat.length === 1 && splat[0].length > 0) {\n    splat = splat[0];\n  }\n\n  let base      = this;\n  let inject    = (base.$inject || []).concat([]);\n  let injectLen = base.$inject.length;\n  let splatIdxs = []\n\n  let idx = inject.indexOf(as);\n  if (idx < 0) { return base; }\n\n  while (idx >= 0) {\n    splatIdxs.unshift(idx);\n    inject.splice(idx, 1);\n    injectLen--;\n    idx = inject.indexOf(as);\n  }\n\n  inject = inject.concat(splat);\n  collectInjections.$inject = inject;\n  return collectInjections;\n\n  function collectInjections() {\n    let inject = Array.prototype.slice.call(arguments, 0, injectLen);\n    let splatVals = Array.prototype.slice.call(arguments, injectLen);\n\n    let namedSplat = {};\n\n    for (let idx in splat) {\n      namedSplat[splat[idx]] = splatVals[idx];\n    }\n\n    for (let idx in splatIdxs) {\n      inject.splice(splatIdxs[idx], 0, namedSplat);\n    }\n\n    return base.apply(this, inject);\n  }\n}\n\napp.constant('$hooks', { $fake: true });\nlet nextHookId = 0;\nfunction pushHook(name, func) {\n  if (!func) return this;\n\n  let base = this;\n  nextHookId++;\n  let hookId = `_hook_${name}_${nextHookId}`;\n  let inject = (base.$inject || []);\n  let hooksIdx = inject.indexOf('$hooks');\n\n  binder.$inject = [hookId].concat(inject);\n  return binder::injectionCollector(hookId, func.$inject);\n\n  function binder(vars, ...rest) {\n    var hooks = rest[hooksIdx];\n    if (!hooks || hooks.$fake) {\n      hooks = {};\n      rest[hooksIdx] = hooks;\n    }\n\n    var chain = hooks[name];\n    if (!chain) {\n      chain = [];\n      hooks[name] = chain;\n    }\n\n    chain.push(hook);\n    return base.apply(this, rest);\n\n    function hook() {\n      return func.apply(this, vars);\n    }\n  }\n}\n"]}